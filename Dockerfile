################################################################################
# BUILDER IMAGE
################################################################################

FROM node:18-buster-slim

ARG VERSION

# ------------------------------------------------------------------------------
# Define and create working directory
# ------------------------------------------------------------------------------

ENV APP_HOME=/app
RUN mkdir -p ${APP_HOME}
WORKDIR ${APP_HOME}

# ------------------------------------------------------------------------------
# Copy source code
# ------------------------------------------------------------------------------

COPY . .

# ------------------------------------------------------------------------------
# Build
# ------------------------------------------------------------------------------

RUN npm install

# non root - a non-root user with read-only fs
# ARG APP_USER=1001

WORKDIR ${APP_HOME}

# ------------------------------------------------------------------------------
# Define user, exposed ports, additional env vars, entrypoint and cmd
# ------------------------------------------------------------------------------

# USER ${APP_USER}

EXPOSE 3000

CMD ["npm", "start"]
